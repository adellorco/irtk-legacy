#!/usr/bin/make -f

# output every command that modifies files on the build system.
DH_VERBOSE = 1

# out-of-tree build
BUILDDIR = $(CURDIR)/debian/build

%:
	dh $@ --buildsystem=cmake --builddirectory=$(BUILDDIR) --parallel

override_dh_auto_configure:
	dh_auto_configure -- \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DBUILD_CARDIAC=OFF \
		-DBUILD_CONDOR_EXE=OFF \
		-DBUILD_DOCUMENTATION=ON \
		-DBUILD_TESTS=OFF \
		-DBUILD_WITH_NIFTI=OFF \
		-DBUILD_WITH_OPENCV=OFF \
		-DBUILD_WITH_PNG=ON \
		-DBUILD_WITH_TBB=ON \
		-DBUILD_WITH_VTK=ON \
		-DWRAP_CYTHON=OFF \
		-DWRAP_PYTHON=OFF

override_dh_auto_build:
		dh_auto_build
		# Generate debhelper file to create symlinks for all 
		# relevant ITK binaries
		for f in $$(find \! -type d | sort); do \
				bname=$$(basename $$f); \
				echo "/usr/lib/irtk/$$bname /usr/bin/irtk-$$bname" >> debian/irtk.links; \
		done
		# Make doxygen documentation
		cd $(BUILDDIR) && $(MAKE) doc

override_dh_auto_clean:
	dh_auto_clean
	rm -rf $(BUILDDIR)
